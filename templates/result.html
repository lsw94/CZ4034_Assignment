{% extends 'base.html' %}
{% load static %}


{% block content %}
    <script>
        $(document).ready(function () {
            $('#filtersForm input:checkbox ').on("change", function(e) {
                e.stopImmediatePropagation();
                var formData = new FormData();
                $('#filtersForm input[type="checkbox"]').each(function () {
                    if ($(this).is(':checked')) {
                        formData.append("filters[]", $.trim($(this).parent().text().toUpperCase()));
                    }
                });
                $.ajax({
                    url: window.location.href,
                    type: "POST", // http method
                    data: formData,
                    processData: false,
                    contentType: false,
                });
                //$('#result_display').load();
            });
        });

         function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        var csrftoken = getCookie('csrftoken');

        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }

        $.ajaxSetup({
            beforeSend: function (xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });
    </script>
    <style>
        .top-positioning {
            margin-left: 11%;
            margin-top: 3%;
        }

        .results-positioning {
            margin-left: 11%;
            margin-top: 4%;
        }

        .text-positioning{
            margin-left: 2%;
        }
        .image-positioning{
            margin-top: 1%;
        }

        .filter-positioning {
            margin-top: 1%;
        }

        .filter-wording {
            margin-left: 9%;
        }

        .url-wording {
            font-size: 0.9em;
            font-family: "Times New Roman", Times, serif;
            color: #28a745;

        }

    </style>

    <div class="row top-positioning">

        <form class="form-check-inline col-lg-5 col-md-6" method="GET" action="{% url 'search' %}">
            {{ form }}
            <button class="btn btn-outline-success" type="submit">Search</button>

        </form>

    </div>

    {% if auto_correct != "" %}
        <div class="row top-positioning">
            <a href="{% url 'search' %}?query={{auto_correct}}">Did you mean {{auto_correct}}?</a>
        </div>
    {% endif %}

    <nav class="navbar navbar-expand-lg navbar-light filter-positioning">

        <div class="navbar-collapse filter-wording" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                       data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Filter
                    </a>

                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">

                        <div class="container" style="margin-top: 1%">
                            <span class="text-uppercase" style="margin-left:20px; color: #28a745">Categories</span>
                            <form id="filtersForm" method="post" class="row" style="margin-top:1%">
                                {% csrf_token %}
                                {% for item in filter %}
                                    {% if forloop.counter == 1 or forloop.counter == 6 or forloop.counter == 11 or forloop.counter == 16 %}
                                        <div class="col-md-3 col-lg-3">
                                        <ul class="nav flex-column">
                                    {% endif %}
                                <li class="nav-item"> {{ item }} {{ item.label }} </li>

                                {% if forloop.counter == 5 or forloop.counter == 10 or forloop.counter == 15 or forloop.counter == 20 %}
                                    </ul></div>
                                {% endif %}
                                {% endfor %}
                            </form>

                        </div>

                    </div>
                </li>
            </ul>
        </div>
    </nav>
    <hr>
    <div id="result_display">
    {% for document in results %}
        <div class="row results-positioning">
            <div class="col-md-1 col-lg-1 image-positioning">
                {% if document.image_url %}
                 <img src={{ document.image_url }} height="56" width="100">

                {% else %}
                    <img src="{% static 'img/noimg.png' %}" height="56" width="100">
                {% endif %}
            </div>
            <div class="col-md-9 col-lg-9 text-positioning">
                <a href={{ document.url }}> {{ document.title }}</a><br/>
                <span class="url-wording">{{ document.url }}</span>
                <br/>
                {{ document.description }}
                {{ document.category }}

            </div>
        </div>
    {% endfor %}
    </div>


{% endblock %}
